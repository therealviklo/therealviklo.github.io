<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Unicodeanalysator</title>
		<link rel="stylesheet" href="/style.css">
		<style>
			textarea
			{
				width: 100%;
				box-sizing: border-box;
			}
		</style>
		<script>
			const textPlaceholder = "Exempel";
			const unicodePlaceholder = "U+0045 U+0078 U+0065 U+006D U+0070 U+0065 U+006C";

			function placeholderCheck(text, unicode)
			{
				if (text.value.length == 0 && unicode.value.length == 0)
				{
					text.placeholder = textPlaceholder;
					unicode.placeholder = unicodePlaceholder;
				}
				else
				{
					text.placeholder = "";
					unicode.placeholder = "";
				}
			}

			function padWithZeroes(str, num)
			{
				if (str.length < num)
					return "0".repeat(num - str.length) + str;
				return str;
			}

			function textChanged()
			{
				const text = document.getElementById("text");
				const unicode = document.getElementById("unicode");
				const textString = text.value;
				let newUnicode = "";
				for (const codePoint of textString)
				{
					if (newUnicode != "")
						newUnicode += " ";
					newUnicode += "U+" + padWithZeroes(codePoint.codePointAt(0).toString(16).toUpperCase(), 4);
				}
				unicode.value = newUnicode;
				placeholderCheck(text, unicode);
			}

			function unicodeChanged()
			{
				const text = document.getElementById("text");
				const unicode = document.getElementById("unicode");
				const sanitisedUnicode = unicode.value.replace(/[^Uu+0-9A-Fa-f\s]/g, "");
				unicode.value = sanitisedUnicode;
				const nums = sanitisedUnicode.replace(/[Uu+]/g, "").split(/\s/g);
				let newText = "";
				nums.forEach(i => {
					if (i != "")
					{
						let num = parseInt(i, 16);
						newText += String.fromCodePoint(num);
					}
				});
				text.value = newText;
				placeholderCheck(text, unicode);
			}
		</script>
	</head>
	<body>
		<iframe src="/header.html" id="header"></iframe>
		<div class="block">
			<h1>Unicodeanalysator</h1>
			<h2>Text</h2>
			<textarea rows="5" id="text" oninput="textChanged()" placeholder="Exempel"></textarea>
			<h2>Unicodekodpunkter</h2>
			<textarea rows="5" id="unicode" oninput="unicodeChanged()" placeholder="U+0045 U+0078 U+0065 U+006D U+0070 U+0065 U+006C"></textarea>
		</div>
	</body>
</html>